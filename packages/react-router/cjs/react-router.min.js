"use strict";
function _interopDefault(t) {
  return t && "object" == typeof t && "default" in t ? t.default : t;
}
Object.defineProperty(exports, "__esModule", { value: !0 });
var createContext = _interopDefault(require("create-react-context"));
require("warning");
var React = _interopDefault(require("react")),
  PropTypes = _interopDefault(require("prop-types")),
  history = require("history"),
  invariant = _interopDefault(require("invariant")),
  pathToRegexp = _interopDefault(require("path-to-regexp"));
require("react-is");
var hoistStatics = _interopDefault(require("hoist-non-react-statics"));
function asyncGeneratorStep(t, e, n, r, o, a, i) {
  try {
    var c = t[a](i),
      s = c.value;
  } catch (t) {
    return void n(t);
  }
  c.done ? e(s) : Promise.resolve(s).then(r, o);
}
function _asyncToGenerator(c) {
  return function() {
    var t = this,
      i = arguments;
    return new Promise(function(e, n) {
      var r = c.apply(t, i);
      function o(t) {
        asyncGeneratorStep(r, e, n, o, a, "next", t);
      }
      function a(t) {
        asyncGeneratorStep(r, e, n, o, a, "throw", t);
      }
      o(void 0);
    });
  };
}
function _extends() {
  return (_extends =
    Object.assign ||
    function(t) {
      for (var e = 1; e < arguments.length; e++) {
        var n = arguments[e];
        for (var r in n)
          Object.prototype.hasOwnProperty.call(n, r) && (t[r] = n[r]);
      }
      return t;
    }).apply(this, arguments);
}
function _inheritsLoose(t, e) {
  (t.prototype = Object.create(e.prototype)),
    ((t.prototype.constructor = t).__proto__ = e);
}
function _objectWithoutPropertiesLoose(t, e) {
  if (null == t) return {};
  var n,
    r,
    o = {},
    a = Object.keys(t);
  for (r = 0; r < a.length; r++) (n = a[r]), 0 <= e.indexOf(n) || (o[n] = t[n]);
  return o;
}
var context = createContext();
function getContext(t, e) {
  return {
    history: t.history,
    location: e.location,
    match: Router.computeRootMatch(e.location.pathname),
    staticContext: t.staticContext
  };
}
(context.Provider.displayName = "Router.Provider"),
  (context.Consumer.displayName = "Router.Consumer");
var Router = (function(n) {
  function t(t) {
    var e;
    return (
      ((e = n.call(this, t) || this).state = { location: t.history.location }),
      (e._isMounted = !1),
      (e._pendingLocation = null),
      t.staticContext ||
        (e.unlisten = t.history.listen(function(t) {
          e._isMounted ? e.setState({ location: t }) : (e._pendingLocation = t);
        })),
      e
    );
  }
  _inheritsLoose(t, n),
    (t.computeRootMatch = function(t) {
      return { path: "/", url: "/", params: {}, isExact: "/" === t };
    });
  var e = t.prototype;
  return (
    (e.componentDidMount = function() {
      (this._isMounted = !0),
        this._pendingLocation &&
          this.setState({ location: this._pendingLocation });
    }),
    (e.componentWillUnmount = function() {
      this.unlisten && this.unlisten();
    }),
    (e.render = function() {
      var t = getContext(this.props, this.state);
      return React.createElement(context.Provider, {
        children: this.props.children || null,
        value: t
      });
    }),
    t
  );
})(React.Component);
React.createContext ||
  ((Router.childContextTypes = { router: PropTypes.object.isRequired }),
  (Router.prototype.getChildContext = function() {
    return { router: getContext(this.props, this.state) };
  }));
var MemoryRouter = (function(o) {
    function t() {
      for (var t, e = arguments.length, n = new Array(e), r = 0; r < e; r++)
        n[r] = arguments[r];
      return (
        ((t =
          o.call.apply(o, [this].concat(n)) ||
          this).history = history.createMemoryHistory(t.props)),
        t
      );
    }
    return (
      _inheritsLoose(t, o),
      (t.prototype.render = function() {
        return React.createElement(Router, {
          history: this.history,
          children: this.props.children
        });
      }),
      t
    );
  })(React.Component),
  Lifecycle = (function(t) {
    function e() {
      return t.apply(this, arguments) || this;
    }
    _inheritsLoose(e, t);
    var n = e.prototype;
    return (
      (n.componentDidMount = function() {
        this.props.onMount && this.props.onMount.call(this, this);
      }),
      (n.componentDidUpdate = function(t) {
        this.props.onUpdate && this.props.onUpdate.call(this, this, t);
      }),
      (n.componentWillUnmount = function() {
        this.props.onUnmount && this.props.onUnmount.call(this, this);
      }),
      (n.render = function() {
        return null;
      }),
      e
    );
  })(React.Component);
function Prompt(e) {
  return React.createElement(context.Consumer, null, function(t) {
    if ((t || invariant(!1), !e.when || t.staticContext)) return null;
    var n = t.history.block,
      r = e.message;
    return React.createElement(Lifecycle, {
      onMount: function(t) {
        t.release = n(r);
      },
      onUpdate: function(t, e) {
        e.message !== r && (t.release(), (t.release = n(r)));
      },
      onUnmount: function(t) {
        t.release();
      }
    });
  });
}
Prompt.defaultProps = { when: !0 };
var cache = {},
  cacheLimit = 1e4,
  cacheCount = 0;
function compilePath(t) {
  if (cache[t]) return cache[t];
  var e = pathToRegexp.compile(t);
  return cacheCount < cacheLimit && ((cache[t] = e), cacheCount++), e;
}
function generatePath(t, e) {
  return (
    void 0 === t && (t = "/"),
    void 0 === e && (e = {}),
    "/" === t ? t : compilePath(t)(e, { pretty: !0 })
  );
}
function Redirect(e) {
  return React.createElement(context.Consumer, null, function(t) {
    t || invariant(!1);
    var n = e.push ? t.history.push : t.history.replace,
      r = history.createLocation(
        e.computedMatch
          ? "string" == typeof e.to
            ? generatePath(e.to, e.computedMatch.params)
            : _extends({}, e.to, {
                pathname: generatePath(e.to.pathname, e.computedMatch.params)
              })
          : e.to
      );
    return t.staticContext
      ? (n(r), null)
      : React.createElement(Lifecycle, {
          onMount: function() {
            n(r);
          },
          onUpdate: function(t, e) {
            history.locationsAreEqual(e.to, r) || n(r);
          },
          to: r
        });
  });
}
Redirect.defaultProps = { push: !1 };
var cache$1 = {},
  cacheLimit$1 = 1e4,
  cacheCount$1 = 0;
function compilePath$1(t, e) {
  var n = "" + e.end + e.strict + e.sensitive,
    r = cache$1[n] || (cache$1[n] = {});
  if (r[t]) return r[t];
  var o = [],
    a = { regexp: pathToRegexp(t, o, e), keys: o };
  return cacheCount$1 < cacheLimit$1 && ((r[t] = a), cacheCount$1++), a;
}
function matchPath(u, t) {
  void 0 === t && (t = {}), "string" == typeof t && (t = { path: t });
  var e = t,
    n = e.path,
    r = e.exact,
    p = void 0 !== r && r,
    o = e.strict,
    h = void 0 !== o && o,
    a = e.sensitive,
    l = void 0 !== a && a;
  return [].concat(n).reduce(function(t, e) {
    if (t) return t;
    var n = compilePath$1(e, { end: p, strict: h, sensitive: l }),
      r = n.regexp,
      o = n.keys,
      a = r.exec(u);
    if (!a) return null;
    var i = a[0],
      c = a.slice(1),
      s = u === i;
    return p && !s
      ? null
      : {
          path: e,
          url: "/" === e && "" === i ? "/" : i,
          isExact: s,
          params: o.reduce(function(t, e, n) {
            return (t[e.name] = c[n]), t;
          }, {})
        };
  }, null);
}
function isEmptyChildren(t) {
  return 0 === React.Children.count(t);
}
function getContext$1(t, e) {
  var n = t.location || e.location;
  return _extends({}, e, {
    location: n,
    match: t.computedMatch
      ? t.computedMatch
      : t.path
        ? matchPath(n.pathname, t)
        : e.match
  });
}
var Route = (function(o) {
  function t() {
    for (var t, e = arguments.length, n = new Array(e), r = 0; r < e; r++)
      n[r] = arguments[r];
    return (
      ((t = o.call.apply(o, [this].concat(n)) || this).state = {
        renderedAsync: null
      }),
      (t.renderingAsync = !1),
      t
    );
  }
  _inheritsLoose(t, o);
  var e = t.prototype;
  return (
    (e.getRenderedAsyncState = function() {
      return (
        this.renderingAsync || this.renderAsync.apply(this, arguments),
        this.state.renderedAsync
      );
    }),
    (e.renderAsync = (function() {
      var n = _asyncToGenerator(
        regeneratorRuntime.mark(function t(e, n) {
          var r;
          return regeneratorRuntime.wrap(
            function(t) {
              for (;;)
                switch ((t.prev = t.next)) {
                  case 0:
                    return (this.renderingAsync = !0), (t.next = 3), e(n);
                  case 3:
                    (r = t.sent),
                      this.setState({ renderedAsync: r }),
                      (this.renderingAsync = !1);
                  case 6:
                  case "end":
                    return t.stop();
                }
            },
            t,
            this
          );
        })
      );
      return function(t, e) {
        return n.apply(this, arguments);
      };
    })()),
    (e.render = function() {
      var i = this;
      return React.createElement(context.Consumer, null, function(t) {
        t || invariant(!1);
        var e = getContext$1(i.props, t),
          n = i.props,
          r = n.children,
          o = n.component,
          a = n.render;
        return (
          Array.isArray(r) && 0 === r.length && (r = null),
          "function" == typeof r && void 0 === (r = r(e)) && (r = null),
          React.createElement(
            context.Provider,
            { value: e },
            r && !isEmptyChildren(r)
              ? r
              : e.match
                ? o
                  ? React.createElement(o, e)
                  : a
                    ? i.getRenderedAsyncState(a, e)
                    : null
                : null
          )
        );
      });
    }),
    t
  );
})(React.Component);
function addLeadingSlash(t) {
  return "/" === t.charAt(0) ? t : "/" + t;
}
function addBasename(t, e) {
  return t ? _extends({}, e, { pathname: addLeadingSlash(t) + e.pathname }) : e;
}
function stripBasename(t, e) {
  if (!t) return e;
  var n = addLeadingSlash(t);
  return 0 !== e.pathname.indexOf(n)
    ? e
    : _extends({}, e, { pathname: e.pathname.substr(n.length) });
}
function createURL(t) {
  return "string" == typeof t ? t : history.createPath(t);
}
function staticHandler(t) {
  return function() {
    invariant(!1);
  };
}
function noop() {}
React.createContext ||
  ((Route.contextTypes = { router: PropTypes.object.isRequired }),
  (Route.childContextTypes = { router: PropTypes.object.isRequired }),
  (Route.prototype.getChildContext = function() {
    this.context.router || invariant(!1);
    var t = this.context.router;
    return { router: getContext$1(this.props, t) };
  }));
var StaticRouter = (function(r) {
  function t() {
    for (var o, t = arguments.length, e = new Array(t), n = 0; n < t; n++)
      e[n] = arguments[n];
    return (
      ((o = r.call.apply(r, [this].concat(e)) || this).createHref = function(
        t
      ) {
        return addLeadingSlash(o.props.basename + createURL(t));
      }),
      (o.handlePush = function(t) {
        var e = o.props,
          n = e.basename,
          r = e.context;
        (r.action = "PUSH"),
          (r.location = addBasename(n, history.createLocation(t))),
          (r.url = createURL(r.location));
      }),
      (o.handleReplace = function(t) {
        var e = o.props,
          n = e.basename,
          r = e.context;
        (r.action = "REPLACE"),
          (r.location = addBasename(n, history.createLocation(t))),
          (r.url = createURL(r.location));
      }),
      (o.handleListen = function() {
        return noop;
      }),
      (o.handleBlock = function() {
        return noop;
      }),
      o
    );
  }
  return (
    _inheritsLoose(t, r),
    (t.prototype.render = function() {
      var t = this.props,
        e = t.basename,
        n = (t.context, t.location),
        r = _objectWithoutPropertiesLoose(t, [
          "basename",
          "context",
          "location"
        ]),
        o = {
          createHref: this.createHref,
          action: "POP",
          location: stripBasename(e, history.createLocation(n)),
          push: this.handlePush,
          replace: this.handleReplace,
          go: staticHandler("go"),
          goBack: staticHandler("goBack"),
          goForward: staticHandler("goForward"),
          listen: this.handleListen,
          block: this.handleBlock
        };
      return React.createElement(
        Router,
        _extends({}, r, { history: o, staticContext: this.props.context || {} })
      );
    }),
    t
  );
})(React.Component);
StaticRouter.defaultProps = { basename: "", location: "/" };
var Switch = (function(t) {
  function e() {
    return t.apply(this, arguments) || this;
  }
  return (
    _inheritsLoose(e, t),
    (e.prototype.render = function() {
      var t = this;
      return React.createElement(context.Consumer, null, function(n) {
        n || invariant(!1);
        var r,
          o,
          a = t.props.location || n.location;
        return (
          React.Children.forEach(t.props.children, function(t) {
            if (null == o && React.isValidElement(t)) {
              var e = (r = t).props.path || t.props.from;
              o = e
                ? matchPath(a.pathname, _extends({}, t.props, { path: e }))
                : n.match;
            }
          }),
          o ? React.cloneElement(r, { location: a, computedMatch: o }) : null
        );
      });
    }),
    e
  );
})(React.Component);
function withRouter(r) {
  var t = function(t) {
    var e = t.wrappedComponentRef,
      n = _objectWithoutPropertiesLoose(t, ["wrappedComponentRef"]);
    return React.createElement(Route, {
      children: function(t) {
        return React.createElement(r, _extends({}, n, t, { ref: e }));
      }
    });
  };
  return (
    (t.displayName = "withRouter(" + (r.displayName || r.name) + ")"),
    (t.WrappedComponent = r),
    hoistStatics(t, r)
  );
}
(exports.MemoryRouter = MemoryRouter),
  (exports.Prompt = Prompt),
  (exports.Redirect = Redirect),
  (exports.Route = Route),
  (exports.Router = Router),
  (exports.StaticRouter = StaticRouter),
  (exports.Switch = Switch),
  (exports.generatePath = generatePath),
  (exports.matchPath = matchPath),
  (exports.withRouter = withRouter),
  (exports.__RouterContext = context);
